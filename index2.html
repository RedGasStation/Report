


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gas Station Report</title>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore-compat.js"></script>
<style>
    input:read-only {
        background-color: #f2f2f2; /* Light gray shade */
        color: #333; /* Optional: Set a consistent text color */
        border: 1px solid #ddd; /* Optional: Add a border for consistency */
        cursor: not-allowed; /* Change the cursor to indicate the field is not editable */
    }
</style>    
<style>
    button[type="submit"]:hover {
        background-color: #c0392b; /* Darker red on hover */
    }
</style>
<style>
    /* General Body Styles */
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f9f9f9;
        color: #333;
        line-height: 1.6;
    }

    /* Login Screen Styles */
    #loginScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, .8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    #loginForm {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, .3);
        width: 300px;
        text-align: center;
        box-sizing: border-box;
    }

    #loginForm input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
    }

    #loginForm button {
        width: 100%;
        padding: 10px;
        background-color: #3498db;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        box-sizing: border-box;
    }

    #loginForm button:hover {
        background-color: #2980b9;
    }

    /* Main Content Styles */
    #mainContent {
        display: none;
    }

    h1 {
        text-align: center;
        color: #2c3e50;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: 700;
    }

    input[type="date"],
    input[type="text"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
    }

    input[type="number"] {
        width: 80px;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 5px;
        text-align: center;
        font-size: 12px;
        -moz-appearance: textfield;
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    button {
        padding: 10px 20px;
        border: none;
        background-color: #3498db;
        color: #fff;
        font-size: 16px;
        font-weight: 700;
        border-radius: 5px;
        cursor: pointer;
    }

    button:hover {
        background-color: #2980b9;
    }

    .form-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, .1);
    }

    .section-title {
        font-size: 18px;
        color: #34495e;
        border-bottom: 2px solid #ddd;
        margin: 30px 0 10px;
        padding-bottom: 5px;
    }

    table {
        width: 100%;
        max-width: 100%; /* Prevent tables from exceeding container width */
        border-collapse: collapse;
        margin-bottom: 20px;
        background-color: #fff;
    }

    th,
    td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center; /* Center-align content horizontally */
        vertical-align: middle; /* Center-align content vertically */
        font-size: 14px;
    }

    th {
        background-color: #eaf2f8;
        color: #2c3e50;
        font-weight: 700;
        text-align: center;
    }

    td input,
    td select {
        margin: 0 auto; /* Center the input fields horizontally */
        width: 90%; /* Ensure inputs stretch to 90% of the cell width */
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
        font-size: 14px;
        text-align: center; /* Center the text inside the input fields */
        display: block; /* Allow centering using margin auto */
    }

    /* Flex Row Styling */
    .flex-row {
        display: flex;
        gap: 20px;
    }

    .flex-row > div {
        flex: 1;
    }

    /* Form Footer Styling */
    .form-footer {
        text-align: center;
        margin-top: 20px;
    }

    @media (max-width: 768px) {
        .form-container {
            padding: 10px;
        }

        .flex-row {
            flex-direction: column;
            gap: 15px;
        }

        .flex-row > div {
            width: 100%;
        }

        table {
            font-size: 12px;
        }

        th, td {
            padding: 6px;
        }

        input[type="number"] {
            width: 100%;
            text-align: left;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }
    }

    /* Scoped Styles for Expenses Section */
    #expensesTable td input {
        width: 95%; /* Applies only to inputs inside #expensesTable */
        padding: 5px;
        box-sizing: border-box;
    }

    #expensesTable button {
        margin-top: 10px;
        padding: 10px 20px;
        background-color: #3498db;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    #expensesTable button:hover {
        background-color: #2980b9;
    }

    /* Discount Table Specific Styling */
    #discountTable th,
    #discountTable td {
        text-align: center; /* Center-align content horizontally */
        vertical-align: middle; /* Center-align content vertically */
    }

    #discountTable input[type="text"],
    #discountTable input[type="number"] {
        margin: 0 auto; /* Center horizontally */
        text-align: center; /* Center text inside input */
        display: block; /* Ensure proper block behavior for alignment */
        width: 90%; /* Adjust width to fit within the cell */
        padding: 5px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
    }

    #discountTable input[type="text"]:focus,
    #discountTable input[type="number"]:focus {
        outline: none;
        border: 1px solid #3498db;
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
    }

    /* General input field styling */
    input[type="text"],
    input[type="number"],
    input[type="datetime-local"],
    select {
        height: 35px; /* Ensure consistent height for all input fields */
        padding: 5px 10px; /* Consistent padding inside the fields */
        margin: 0; /* Remove margin for consistency */
        border: 1px solid #ddd; /* Standard border for all inputs */
        border-radius: 5px; /* Rounded corners for consistency */
        box-sizing: border-box; /* Include padding and border in width */
        font-size: 14px; /* Consistent font size across fields */
        line-height: 1.2; /* Align text vertically in input fields */
    }

    /* Table-specific input styles */
    table input[type="text"],
    table input[type="number"] {
        width: 90%; /* Ensure inputs do not exceed cell width */
        text-align: left; /* Align text to the left for readability */
        display: block; /* Ensure proper block behavior */
        margin: auto; /* Center-align within cells */
    }

    /* Ensure table cells have consistent height and vertical alignment */
    table th,
    table td {
        vertical-align: middle; /* Vertically center align content */
        padding: 10px; /* Add consistent padding */
    }

    /* Adjust input fields in "Expenses" table */
    #expensesTable input {
        width: 95%; /* Ensure inputs fill the available cell space */
    }

    /* Adjust input fields in "Purchase Order" table */
    #purchaseOrderTable input {
        width: 95%; /* Standardize input width */
    }

    /* Focus state for all inputs */
    input:focus {
        outline: none;
        border: 1px solid #3498db; /* Highlight with blue border */
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.5); /* Subtle shadow for focus */
    }
    
    /* Adjust the width of the Pump column */
table th:first-child, /* First column in the table */
table td:first-child { /* First column cells */
    width: 20%; /* Set a wider column for Pump names */
    text-align: left; /* Align text to the left for readability */
}

#passwordModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
    justify-content: center;
    align-items: center;
}

#passwordModal > div {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    width: 300px;
}

#passwordModal input[type="password"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
}

#passwordModal button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

#passwordModal button#passwordSubmit {
    background-color: #3498db;
    color: white;
}

#passwordModal button#passwordCancel {
    background-color: #e74c3c;
    color: white;
    margin-left: 10px;
}

</style>

</head>

<body>
<div id="passwordModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; justify-content: center; align-items: center;">
    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; width: 300px;">
        <h3 style="margin-bottom: 15px;">Enter Admin Password</h3>
        <input id="passwordInput" type="password" placeholder="Password" style="width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;">
        <div>
            <button id="passwordSubmit" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">Submit</button>
            <button id="passwordCancel" style="padding: 10px 20px; background-color: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">Cancel</button>
        </div>
    </div>
</div>

<div id="loginScreen">
    <form id="loginForm">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Username" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="button" onclick="validateLogin()">Login</button>
        <p id="loginError" style="color:red; display:none">Invalid credentials. Try again.</p>
    </form>
</div>
<div id="mainContent" style="display: none;">
    <div class="form-container">
        <form id="gasStationForm">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;margin-bottom:15px">
                
                <!-- Left Section: Station Name & Branch Selection -->
                <div style="flex:1;">
<!--                     <p style="margin:0;font-size:16px;font-weight:700;color:red">RED STAR GAS STATION</p> -->
                    
                    <!-- Navigation Bar for DAILY | WEEKLY -->
<div id="navTabs" style="text-align: center; margin-bottom: 20px;">
    <a href="https://redstargas-ec7ed.web.app/" style="padding: 10px 20px; text-decoration: none; font-weight: bold; 
        border-bottom: 3px solid #e74c3c; color: white; background: #e74c3c;">DAILY</a>
    
    <a href="https://redstar-27bfa.web.app/" style="padding: 10px 20px; text-decoration: none; font-weight: bold; 
        border-bottom: 3px solid #bdc3c7; color: #2c3e50; background: #bdc3c7;">WEEKLY</a>
</div>

                    <!-- Branch Selection: Now aligned properly -->
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                        <label for="branchSelection" style="font-weight: bold; white-space: nowrap;">Branch:</label>
<select id="branchSelection" name="branchSelection" onchange="handleBranchChange()" style="padding:5px; width: 250px; border: 1px solid #ddd; border-radius: 5px;">
    <option value="" disabled selected>Select Branch</option>
    <option value="branch1">1 - Red Star Gas Station</option>
    <option value="branch2">2 - MVS Gas Station</option>
    <option value="branch3">3 - Star 888 Gas Station</option>
</select>
                    </div>

                    <!-- Dynamic Address Display -->
                    <p id="branchAddress" style="margin-top: 5px;font-size:14px;color:#34495e;font-weight:600;"></p>

                    <p id="reportNumber" style="margin-top:5px; font-size:14px; font-weight:bold; color:#34495e;">REPORT NUMBER: Loading...</p>
                </div>

                <!-- Right Section: Crew, Cashier, Shift, Date -->
                <div style="flex:1;">
                    <div style="display:flex;flex-direction:column;gap:10px">
                        <div style="display:flex;gap:10px">
                            <label for="crewName" style="flex:0 0 120px;font-weight:700">Crew Name:</label> 
                            <input type="text" id="crewName" name="crewName" required style="flex:1;padding:8px;border:1px solid #ddd;border-radius:5px">
                        </div>
                        <div style="display:flex;gap:10px">
                            <label for="cashierName" style="flex:0 0 120px;font-weight:700">Cashier:</label> 
                            <input type="text" id="cashierName" name="cashierName" required style="flex:1;padding:8px;border:1px solid #ddd;border-radius:5px">
                        </div>
                        <div style="display:flex;gap:10px">
                            <label for="shiftTime" style="flex:0 0 120px;font-weight:700">Shift (Time):</label> 
                            <select id="shiftTime" name="shiftTime" required style="flex:1;padding:8px;border:1px solid #ddd;border-radius:5px">
                                <option value="" disabled selected>Select Shift</option>
                                <option value="06:00am to 15:00pm">06:00am to 15:00pm</option>
                                <option value="14:00pm to 22:00pm">14:00pm to 22:00pm</option>
                                <option value="21:00pm to 06:00am">21:00pm to 06:00am</option>
                            </select>
                        </div>
                        <div style="display:flex;gap:10px">
                            <label for="reportDate" style="flex:0 0 120px;font-weight:700">Date:</label> 
                            <input type="date" id="reportDate" name="reportDate" required style="flex:1;padding:8px;border:1px solid #ddd;border-radius:5px">
                        </div>
                    </div>
                </div>

            </div>
            <div class="section-title">Electronic Reading</div>
            <table>
                <thead>
                    <tr>
                        <th>Pump</th>
                        <th>Opening</th>
                        <th>Closing</th>
                        <th>Calibration</th>
                        <th>Liters Sold</th>
                        <th>Pump Price</th>
                        <th>Total Sales</th>
                    </tr>
                </thead>
                <tbody>
                  <tr>
    <td>Premium 1</td>
    <td><input type="number" name="premium1Opening" onchange="updateValues(this)"></td>
    <td><input type="number" name="premium1Closing" onchange="updateValues(this); computeDipstickClosing();"></td>
    <td><input type="number" name="premium1Calibration" onchange="updateValues(this)"></td>
    <td><input type="number" name="premium1Liters" onchange="computeDipstickFromPumpReadings()" readonly="readonly"></td>
    <td><input type="number" name="premium1Price" data-column="PumpPrice" id="premium1Price" readonly onchange="updateValues(this)"></td>
    <td><input type="number" name="premium1Sales" onchange="updateFuelSalesTotal()" readonly="readonly"></td>
</tr>
<tr>
    <td>Premium 2</td>
    <td><input type="number" name="premium2Opening" onchange="updateValues(this)"></td>
    <td><input type="number" name="premium2Closing" onchange="updateValues(this); computeDipstickClosing();"></td>
    <td><input type="number" name="premium2Calibration" onchange="updateValues(this)"></td>
    <td><input type="number" name="premium2Liters" onchange="computeDipstickFromPumpReadings()" readonly="readonly"></td>
    <td><input type="number" name="premium2Price" data-column="PumpPrice" readonly id="premium2Price" onchange="updateValues(this)"></td>
    <td><input type="number" name="premium2Sales" onchange="updateFuelSalesTotal()" readonly="readonly"></td>
</tr>
<tr>
    <td>Unleaded 1</td>
    <td><input type="number" name="unleaded1Opening" onchange="updateValues(this)"></td>
    <td><input type="number" name="unleaded1Closing" onchange="updateValues(this); computeDipstickClosing();"></td>
    <td><input type="number" name="unleaded1Calibration" onchange="updateValues(this)"></td>
    <td><input type="number" name="unleaded1Liters" onchange="computeDipstickFromPumpReadings()" readonly="readonly"></td>
    <td><input type="number" name="unleaded1Price" data-column="PumpPrice" readonly id="unleaded1Price" onchange="updateValues(this)"></td>
    <td><input type="number" name="unleaded1Sales" onchange="updateFuelSalesTotal()" readonly="readonly"></td>
</tr>
<tr>
    <td>Unleaded 2</td>
    <td><input type="number" name="unleaded2Opening" onchange="updateValues(this)"></td>
    <td><input type="number" name="unleaded2Closing" onchange="updateValues(this); computeDipstickClosing();"></td>
    <td><input type="number" name="unleaded2Calibration" onchange="updateValues(this)"></td>
    <td><input type="number" name="unleaded2Liters" onchange="computeDipstickFromPumpReadings()" readonly="readonly"></td>
    <td><input type="number" name="unleaded2Price" data-column="PumpPrice" readonly id="unleaded2Price" onchange="updateValues(this)"></td>
    <td><input type="number" name="unleaded2Sales" onchange="updateFuelSalesTotal()" readonly="readonly"></td>
</tr>
<tr>
    <td>Diesel 1</td>
    <td><input type="number" name="diesel1Opening" onchange="updateValues(this)"></td>
    <td><input type="number" name="diesel1Closing" onchange="updateValues(this); computeDipstickClosing();"></td>
    <td><input type="number" name="diesel1Calibration" onchange="updateValues(this)"></td>
    <td><input type="number" name="diesel1Liters" onchange="computeDipstickFromPumpReadings()" readonly="readonly"></td>
    <td><input type="number" name="diesel1Price" data-column="PumpPrice" readonly id="diesel1Price" onchange="updateValues(this)"></td>
    <td><input type="number" name="diesel1Sales" onchange="updateFuelSalesTotal()" readonly="readonly"></td>
</tr>
<tr>
    <td>Diesel 2</td>
    <td><input type="number" name="diesel2Opening" onchange="updateValues(this)"></td>
    <td><input type="number" name="diesel2Closing" onchange="updateValues(this); computeDipstickClosing();"></td>
    <td><input type="number" name="diesel2Calibration" onchange="updateValues(this)"></td>
    <td><input type="number" name="diesel2Liters" onchange="computeDipstickFromPumpReadings()" readonly="readonly"></td>
    <td><input type="number" name="diesel2Price" data-column="PumpPrice" readonly id="diesel2Price" onchange="updateValues(this)"></td>
    <td><input type="number" name="diesel2Sales" onchange="updateFuelSalesTotal()" readonly="readonly"></td>
</tr>

                </tbody>
                    <tfoot>
        <tr>
            <td colspan="6" style="text-align: right; font-weight: bold;">Total Fuel Sales</td>
            <td><input type="number" id="totalFuelSales" name="totalFuelSales" readonly style="width: 90%; text-align: center; padding: 5px; box-sizing: border-box; background-color: #e9ecef;"></td>
        </tr>
    </tfoot>
            </table>
            

<div class="section-title">Dipstick</div>
<table>
    <thead>
        <tr>
            <th>Type</th>
            <th>Opening</th>
            <th>Total Liters Sold</th>
            <th>Delivery</th>
            <th>Closing</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Premium</td>
            <td><input type="number" id="premiumOpening"></td>
            <td><input type="number" id="premiumTotalLitersSold" readonly></td>
            <td><input type="number" id="premiumDelivery"></td>
            <td><input type="number" id="premiumClosing"></td>
        </tr>
        <tr>
            <td>Unleaded</td>
            <td><input type="number" id="unleadedOpening"></td>
            <td><input type="number" id="unleadedTotalLitersSold" readonly></td>
            <td><input type="number" id="unleadedDelivery"></td>
            <td><input type="number" id="unleadedClosing"></td>
        </tr>
        <tr>
            <td>Diesel</td>
            <td><input type="number" id="dieselOpening"></td>
            <td><input type="number" id="dieselTotalLitersSold" readonly></td>
            <td><input type="number" id="dieselDelivery"></td>
            <td><input type="number" id="dieselClosing"></td>
        </tr>
    </tbody>
</table>


            <div class="section-title">Product Delivery Details</div>
            <table>
                <thead>
                    <tr>
                        <th style="width: 25%;">Date & Time</th>
                        <th>Product</th>
                        <th>Before</th>
                        <th>After</th>
                        <th style="width: 80px;">Total Received</th>
                        <th style="width: 100px">Plate Number</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="datetime-local" name="premiumDateTime" style="width:200px"></td>
                        <td>Premium</td>
                        <td><input type="number" name="premiumBefore" style="width:60px"></td>
                        <td><input type="number" name="premiumAfter" style="width:60px"></td>
                        <td><input type="number" name="premiumTotalReceived" style="width:60px"></td>
                        <td>DR Number</td>
                        <td><input type="number" name="DRNumber" style="width:100px"></td>
                    </tr>
                    <tr>
                        <td><input type="datetime-local" name="unleadedDateTime" style="width:200px"></td>
                        <td>Unleaded</td>
                        <td><input type="number" name="unleadedBefore" style="width:60px"></td>
                        <td><input type="number" name="unleadedAfter" style="width:60px"></td>
                        <td><input type="number" name="unleadedTotalReceived" style="width:60px"></td>
                        <td>Delivered By</td>
                        <td><input type="text" name="DeliveredBy" style="width:100px"></td>
                    </tr>
                    <tr>
                        <td><input type="datetime-local" name="dieselDateTime" style="width:200px"></td>
                        <td>Diesel</td>
                        <td><input type="number" name="dieselBefore" style="width:60px"></td>
                        <td><input type="number" name="dieselAfter" style="width:60px"></td>
                        <td><input type="number" name="dieselTotalReceived" style="width:60px"></td>
                        <td>Received By</td>
                        <td><input type="text" name="ReceivedBy" style="width:100px"></td>
                    </tr>
                </tbody>
            </table>
            
        <!-- Expenses Section -->
      <div class="section-title">Expenses</div>
<table id="expensesTable" style="width: 100%;">
    <thead>
        <tr>
            <th style="width: 75%;">Particulars</th>
            <th style="width: 25%;">Amount</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><input type="text" name="expensesParticulars[]" style="width: 95%;"></td>
            <td><input type="number" name="expensesAmount[]" style="width: 95px; text-align:center;" oninput="updateTotalExpenses()"></td>
        </tr>
        <tr>
            <td><input type="text" name="expensesParticulars[]" style="width: 95%;"></td>
            <td><input type="number" name="expensesAmount[]" style="width: 95px; text-align:center;" oninput="updateTotalExpenses()"></td>
        </tr>
        <tr>
            <td><input type="text" name="expensesParticulars[]" style="width: 95%;"></td>
            <td><input type="number" name="expensesAmount[]" style="width: 95px; text-align:center;" oninput="updateTotalExpenses()"></td>
        </tr>
    </tbody>
    <tfoot>
        <tr>
            <td style="text-align: right; font-weight: bold;">Total Expenses</td>
            <td><input type="number" id="totalExpenses" readonly style="width: 95px; background-color: #e9ecef;"></td>
        </tr>
    </tfoot>
</table>
<button type="button" onclick="addExpenseRow()">+ Add Expense</button>
    
            <div class="section-title">Discount</div>
            <table id="discountTable">
                <thead>
                    <tr>
                        <th style="text-align:left;width:25%;padding:10px;background-color:#f2f2f2">Client Name</th>
                        <th style="text-align:left;width:20%;padding:10px;background-color:#f2f2f2">Product</th>
                        <th style="text-align:left;width:15%;padding:10px;background-color:#f2f2f2">Liters</th>
                        <th style="text-align:left;width:20%;padding:10px;background-color:#f2f2f2">Discount per Liter</th>
                        <th style="text-align:left;width:20%;padding:10px;background-color:#f2f2f2">Total Discount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" name="discountClientName[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
                        <td><input type="text" name="discountProduct[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
                        <td><input type="number" name="discountLiters[]" style="width:90%;padding:5px;box-sizing:border-box" onchange="updateTotalDiscount(this)"></td>
                        <td><input type="number" name="discountPerLiter[]" data-column="DiscountPerLiter" readonly id="discountPerLiter1" style="width:90%;padding:5px;box-sizing:border-box" onchange="updateTotalDiscount(this)"></td>
                        <td><input type="number" name="discountTotal[]" readonly="readonly" style="width:90%;padding:5px;box-sizing:border-box;background-color:#e9ecef"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="discountClientName[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
                        <td><input type="text" name="discountProduct[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
                        <td><input type="number" name="discountLiters[]" style="width:90%;padding:5px;box-sizing:border-box" onchange="updateTotalDiscount(this)"></td>
                        <td><input type="number" name="discountPerLiter[]" data-column="DiscountPerLiter" readonly id="discountPerLiter[]" style="width:90%;padding:5px;box-sizing:border-box" onchange="updateTotalDiscount(this)"></td>
                        <td><input type="number" name="discountTotal[]" readonly="readonly" style="width:90%;padding:5px;box-sizing:border-box;background-color:#e9ecef"></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="discountClientName[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
                        <td><input type="text" name="discountProduct[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
                        <td><input type="number" name="discountLiters[]" style="width:90%;padding:5px;box-sizing:border-box" onchange="updateTotalDiscount(this)"></td>
                        <td><input type="number" name="discountPerLiter[]" data-column="DiscountPerLiter" readonly id="discountPerLiter[]" style="width:90%;padding:5px;box-sizing:border-box" onchange="updateTotalDiscount(this)"></td>
                        <td><input type="number" name="discountTotal[]" readonly="readonly" style="width:90%;padding:5px;box-sizing:border-box;background-color:#e9ecef"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" style="text-align:right;font-weight:700;padding:10px">Total Discount</td>
                        <td><input type="number" id="totalDiscount" readonly="readonly" style="width:90%;padding:5px;box-sizing:border-box;background-color:#e9ecef"></td>
                    </tr>
                </tfoot>
            </table><button type="button" onclick="addDiscountRow()" style="margin-top:10px;padding:8px 16px;font-size:14px">+ Add Discount</button>
           
           <script>
           let discountRowCounter = 0; // Counter to track the number of rows

function addDiscountRow() {
    const discountTableBody = document.getElementById("discountTable").getElementsByTagName("tbody")[0];
    const newRow = document.createElement("tr");

    newRow.innerHTML = `
        <td><input type="text" name="discountClientName[]" style="width: 95%; padding: 5px; box-sizing: border-box;"></td>
        <td><input type="text" name="discountProduct[]" style="width: 95%; padding: 5px; box-sizing: border-box;"></td>
        <td><input type="number" name="discountLiters[]" style="width: 90%; padding: 5px; box-sizing: border-box;"></td>
        <td>
            <input type="number" name="discountPerLiter[]" data-column="DiscountPerLiter" style="width: 90%; padding: 5px; box-sizing: border-box; background-color: #e9ecef;" readonly onchange="updateTotalDiscount(this)">
        </td>
        <td><input type="number" name="discountTotal[]" readonly style="width: 90%; padding: 5px; box-sizing: border-box; background-color: #e9ecef;"></td>
    `;

    discountTableBody.appendChild(newRow);

    // Apply restrictions to the new row if the current user is a regular user
    if (currentUserRole === "user") {
        restrictFields('input[data-column="DiscountPerLiter"]');
    }
    discountTableBody.appendChild(newRow);
 
}

</script>           

<script>
// Predefined users with roles
const users = {
    admin: { password: "password123", role: "admin" },
    user: { password: "user123", role: "user" },
};

let currentUserRole = null;

// Login validation function
function validateLogin() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    if (users[username] && users[username].password === password) {
        currentUserRole = users[username].role;
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
        applyUserPermissions();
    } else {
        alert("Invalid credentials. Please try again.");
    }
}

// Apply role-based permissions
function applyUserPermissions() {
    // Fields that are password-protected for user users
    const passwordProtectedSelectors = [
        'input[data-column="PumpPrice"]',        // Pump Price column
        'input[data-column="DiscountPerLiter"]', // Discount Per Liter column
        'input[data-column="PODiscount"]'        // Discount column in Purchase Order section
    ];

    // Fields that must always remain readonly (locked for all users)
    const alwaysReadonlySelectors = [
        'input[name$="Liters"]',    // Liters Sold column
        'input[name$="Sales"]',     // Total Sales column
        '#totalExpenses',           // Total Expenses
        'input[name$="Amount"]',    // Purchase Amount column
        'input[name$="Total"]',     // Total Discount column
        '#premiumTotalLitersSold',  // Dipstick Total Liters Sold
        '#unleadedTotalLitersSold',
        '#dieselTotalLitersSold',
        '#cashBreakdownTotal',      // Total Cash
        '#summaryFuelSales',
        '#summaryExpenses',
        '#summaryDiscount',
        '#summaryPO',
        '#summaryCash',
        '#shortOver'
    ];

    // Lock always-readonly fields (no password handling)
    lockAlwaysReadonlyFields(alwaysReadonlySelectors);

    if (currentUserRole === "user") {
        console.log("Applying restrictions for regular user...");
        // Lock password-protected fields and attach password handler for user role
        restrictFields(passwordProtectedSelectors, true);
    }

    if (currentUserRole === "admin") {
        console.log("Admin logged in...");
        // Unlock admin-editable fields
        allowFields(passwordProtectedSelectors);
    }
}

// Lock always-readonly fields (no password modal)
function lockAlwaysReadonlyFields(selectors) {
    selectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(field => {
            field.setAttribute("readonly", true);
            field.style.backgroundColor = "#f2f2f2"; // Grey background for readonly fields
            field.style.cursor = "not-allowed"; // Non-editable cursor
            field.removeEventListener("focus", requestPasswordHandler); // Ensure no password handler is attached
        });
    });
}

// Request password and unlock the entire column
function requestPasswordForColumn(field) {
    const column = field.getAttribute("data-column");
    const passwordModal = document.getElementById("passwordModal");
    const passwordInput = document.getElementById("passwordInput");
    const passwordSubmit = document.getElementById("passwordSubmit");
    const passwordCancel = document.getElementById("passwordCancel");

    // Show the modal
    passwordModal.style.display = "flex";

    // Handle submit button click
    passwordSubmit.onclick = function () {
        const enteredPassword = passwordInput.value;

        if (enteredPassword === users.admin.password) {
            // Unlock the column if the password is correct
            document.querySelectorAll(`input[data-column="${column}"]`).forEach(input => {
                input.removeAttribute("readonly");
                input.style.backgroundColor = "#fff";
                input.removeEventListener("focus", requestPasswordHandler); // Remove the password handler
            });

            alert(`Column "${column}" unlocked. You can now edit it.`);
        } else {
            alert("Incorrect password. You cannot edit this column.");
        }

        // Clear the input field and hide the modal
        passwordInput.value = "";
        passwordModal.style.display = "none";

        // Remove focus from the field to prevent looping
        field.blur();
    };

    // Handle cancel button click
    passwordCancel.onclick = function () {
        passwordInput.value = "";
        passwordModal.style.display = "none";
        field.blur();
    };
}

// Focus event handler
function requestPasswordHandler(event) {
    requestPasswordForColumn(event.target);
}

// Restrict fields and attach password protection
function restrictFields(selectors, isPasswordProtected = false) {
    selectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(field => {
            field.setAttribute("readonly", true);
            field.style.backgroundColor = "#f2f2f2"; // Grey background for readonly fields
            field.style.cursor = "not-allowed"; // Non-editable cursor

            // Attach password protection for password-protected fields (user role only)
            if (isPasswordProtected && currentUserRole === "user") {
                field.addEventListener("focus", requestPasswordHandler);
            } else {
                field.removeEventListener("focus", requestPasswordHandler); // Ensure no password handler is attached
            }
        });
    });
}

// Allow editable fields
function allowFields(selectors) {
    selectors.forEach(selector => {
        document.querySelectorAll(selector).forEach(field => {
            field.removeAttribute("readonly");
            field.style.backgroundColor = "#fff"; // White background for editable fields
            field.style.cursor = "text"; // Default cursor for editable fields
        });
    });
}

// Attach Enter key functionality for login
document.getElementById("loginForm").addEventListener("keydown", function (event) {
    if (event.key === "Enter") {
        event.preventDefault();
        validateLogin();
    }
});

// Request password and unlock the entire column
function requestPasswordForColumn(field) {
    const column = field.getAttribute("data-column");
    const passwordModal = document.getElementById("passwordModal");
    const passwordInput = document.getElementById("passwordInput");
    const passwordSubmit = document.getElementById("passwordSubmit");
    const passwordCancel = document.getElementById("passwordCancel");

    // Show the modal
    passwordModal.style.display = "flex";

    // Handle submit button click
    passwordSubmit.onclick = function () {
        const enteredPassword = passwordInput.value;

        if (enteredPassword === users.admin.password) {
            // Unlock the column if the password is correct
            document.querySelectorAll(`input[data-column="${column}"]`).forEach(input => {
                input.removeAttribute("readonly");
                input.style.backgroundColor = "#fff";
                input.removeEventListener("focus", requestPasswordHandler);
            });

            alert(`Column "${column}" unlocked. You can now edit it.`);
        } else {
            alert("Incorrect password. You cannot edit this column.");
        }

        // Clear the input field and hide the modal
        passwordInput.value = "";
        passwordModal.style.display = "none";

        // Remove focus from the field to prevent looping
        field.blur();
    };

    // Handle cancel button click
    passwordCancel.onclick = function () {
        // Clear the input field and hide the modal
        passwordInput.value = "";
        passwordModal.style.display = "none";

        // Remove focus from the field to prevent looping
        field.blur();
    };
}

// Focus event handler
function requestPasswordHandler(event) {
    requestPasswordForColumn(event.target);
}

// Restrict fields and attach password protection
function restrictFields(selector) {
    document.querySelectorAll(selector).forEach(field => {
        field.setAttribute("readonly", true);
        field.style.backgroundColor = "#e9ecef";
        field.addEventListener("focus", requestPasswordHandler);
    });
}
    // Attach Enter key functionality for login
    document.getElementById("loginForm").addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            validateLogin();
        }
    });

</script>
    
<script>
function addExpenseRow() {
    var e = document.getElementById("expensesTable").getElementsByTagName("tbody")[0];
    var t = document.createElement("tr");
    t.innerHTML = `
        <td><input type="text" name="expensesParticulars[]" style="width: 95%; padding: 5px; box-sizing: border-box;"></td>
        <td><input type="number" name="expensesAmount[]" style="width: 95px; text-align:center; padding: 5px; box-sizing: border-box;" oninput="updateTotalExpenses()"></td>
    `;
    e.appendChild(t);
}

function updateTotalDiscount(e) {
                    var e = e.closest("tr"),
                        t = parseFloat(e.querySelector('input[name="discountLiters[]"]').value) || 0,
                        n = parseFloat(e.querySelector('input[name="discountPerLiter[]"]').value) || 0;
                    e.querySelector('input[name="discountTotal[]"]').value = (t * n).toFixed(2), updateDiscountSummary()
                    
}

 function updateDiscountSummary() {
    const totalDiscount = Array.from(document.querySelectorAll('input[name="discountTotal[]"]')).reduce((sum, input) => {
        return sum + (parseFloat(input.value) || 0);
    }, 0);

    document.getElementById("totalDiscount").value = totalDiscount.toFixed(2);

    // Update Summary
    updateSummary();
}

</script>
            
<div class="section-title">Purchase Order</div>
<table id="purchaseOrderTable" style="width:100%;border-collapse:collapse">
    <thead>
        <tr>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">Customer's Name</th>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">Vehicle No.</th>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">PO #</th>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">Product</th>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">Liters</th>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">Price</th>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">Discount</th>
            <th style="text-align:left;padding:10px;background-color:#f2f2f2">Amount</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><input type="text" name="poCustomerName[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poVehicleNo[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poNumber[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td>
                <select name="poProduct[]" style="width:95%;padding:5px;box-sizing:border-box" onchange="updatePOPrice(this)">
                    <option value="" disabled selected>Select Product</option>
                    <option value="Premium">Premium</option>
                    <option value="Unleaded">Unleaded</option>
                    <option value="Diesel">Diesel</option>
                </select>
            </td>
            <td><input type="number" name="poLiters[]" style="width:95%;padding:5px;box-sizing:border-box" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poPrice[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
            <td><input type="number" name="poDiscount[]" style="width:95%;padding:5px;box-sizing:border-box" data-column="PODiscount" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poAmount[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
        </tr>
          <tr>
            <td><input type="text" name="poCustomerName[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poVehicleNo[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poNumber[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td>
                <select name="poProduct[]" style="width:95%;padding:5px;box-sizing:border-box" onchange="updatePOPrice(this)">
                    <option value="" disabled selected>Select Product</option>
                    <option value="Premium">Premium</option>
                    <option value="Unleaded">Unleaded</option>
                    <option value="Diesel">Diesel</option>
                </select>
            </td>
            <td><input type="number" name="poLiters[]" style="width:95%;padding:5px;box-sizing:border-box" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poPrice[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
            <td><input type="number" name="poDiscount[]" style="width:95%;padding:5px;box-sizing:border-box" data-column="PODiscount" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poAmount[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
        </tr>
          <tr>
            <td><input type="text" name="poCustomerName[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poVehicleNo[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poNumber[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td>
                <select name="poProduct[]" style="width:95%;padding:5px;box-sizing:border-box" onchange="updatePOPrice(this)">
                    <option value="" disabled selected>Select Product</option>
                    <option value="Premium">Premium</option>
                    <option value="Unleaded">Unleaded</option>
                    <option value="Diesel">Diesel</option>
                </select>
            </td>
            <td><input type="number" name="poLiters[]" style="width:95%;padding:5px;box-sizing:border-box" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poPrice[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
            <td><input type="number" name="poDiscount[]" style="width:95%;padding:5px;box-sizing:border-box" data-column="PODiscount" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poAmount[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
        </tr>
          <tr>
            <td><input type="text" name="poCustomerName[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poVehicleNo[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td><input type="text" name="poNumber[]" style="width:95%;padding:5px;box-sizing:border-box"></td>
            <td>
                <select name="poProduct[]" style="width:95%;padding:5px;box-sizing:border-box" onchange="updatePOPrice(this)">
                    <option value="" disabled selected>Select Product</option>
                    <option value="Premium">Premium</option>
                    <option value="Unleaded">Unleaded</option>
                    <option value="Diesel">Diesel</option>
                </select>
            </td>
            <td><input type="number" name="poLiters[]" style="width:95%;padding:5px;box-sizing:border-box" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poPrice[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
            <td><input type="number" name="poDiscount[]" style="width:95%;padding:5px;box-sizing:border-box" data-column="PODiscount" oninput="updatePurchaseOrderTotal(this)"></td>
            <td><input type="number" name="poAmount[]" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
        </tr>
        </tbody>
    <tfoot>
        <tr>
            <td colspan="7" style="text-align:right;font-weight:700;padding:10px">Total</td>
            <td><input type="number" id="poTotalAmount" readonly style="width:95%;padding:5px;box-sizing:border-box;background-color:#e9ecef;"></td>
        </tr>
    </tfoot>
</table>
<button type="button" onclick="addPurchaseOrderRow()" style="margin-top:10px;padding:8px 16px;font-size:14px">+ Add Purchase Order</button>

<script>

function updatePreviousPricesFromPumpSection() {
    console.log("üîÑ Updating previousPrices from Pump Section...");

    previousPrices = {}; // Reset previousPrices

    document.querySelectorAll('[name$="Price"]').forEach(input => {
        let productName = input.name.replace(/[0-9]/g, '').replace("Price", "").trim(); // Remove numbers
        let price = parseFloat(input.value) || 0;

        if (productName) {
            previousPrices[productName] = price;
        }
    });

    console.log("üìå Updated previousPrices:", previousPrices);
}


// Store latest prices in a global variable


let previousPrices = { premium: 0, unleaded: 0, diesel: 0 };
// Fetch latest pump prices from Firebase
async function fetchPreviousPumpPrices() {
    console.log("üî• Fetching previous pump prices...");

    const firestore = firebase.firestore();
    const branchSelection = document.getElementById("branchSelection").value;

    if (!branchSelection) {
        console.log("üö® No branch selected. Skipping fetch.");
        return;
    }

    console.log(`üîç Searching for pump prices for branch: ${branchSelection}`);

    try {
        const querySnapshot = await firestore
            .collection("gasStationReports")
            .where("branchSelection", "==", branchSelection)
            .orderBy("reportNumber", "desc")
            .limit(1)
            .get();

        if (querySnapshot.empty) {
            console.warn("‚ùå No previous pump prices found for this branch.");
            return;
        }

        const lastReport = querySnapshot.docs[0].data();
        console.log("üìÑ Last report fetched:", lastReport);

        // ‚úÖ Populate previousPrices before updating PO prices
        previousPrices = {
            Premium: parseFloat(lastReport.premium1Price) || 0,
            Unleaded: parseFloat(lastReport.unleaded1Price) || 0,
            Diesel: parseFloat(lastReport.diesel1Price) || 0
        };

        console.log("‚úÖ Pump prices updated:", previousPrices);

    } catch (error) {
        console.error("‚ùå Error fetching previous pump prices:", error);
    }
}


// Update price when product is selected
function updatePOPrice(selectElement) {
    const row = selectElement.closest("tr");
    let priceField = row.querySelector('input[name="poPrice[]"]');

    // ‚úÖ Get the selected product
    let selectedProduct = selectElement.value;

    // ‚úÖ Get the corresponding pump price field
    let pumpPriceFieldId;
    switch (selectedProduct) {
        case "Premium":
            pumpPriceFieldId = "premium1Price";
            break;
        case "Unleaded":
            pumpPriceFieldId = "unleaded1Price";
            break;
        case "Diesel":
            pumpPriceFieldId = "diesel1Price";
            break;
        default:
            priceField.value = ""; // ‚úÖ Clear price if no valid selection
            return;
    }

    // ‚úÖ Get the price from the pump section
    let pumpPriceField = document.getElementById(pumpPriceFieldId);
    if (!pumpPriceField || !pumpPriceField.value) {
        console.warn(`üö® Pump price not found for ${selectedProduct}. Keeping price as 0.`);
        priceField.value = "0.00"; // ‚úÖ Set default if no price is available
    } else {
        priceField.value = parseFloat(pumpPriceField.value).toFixed(2);
        console.log(`‚úÖ Updated PO Price for ${selectedProduct}: ${priceField.value}`);
    }

    updatePurchaseOrderTotal(row.querySelector('input[name="poLiters[]"]'));
}


// Add new purchase order row dynamically
function addPurchaseOrderRow() {
    const purchaseOrderTableBody = document.getElementById("purchaseOrderTable").getElementsByTagName("tbody")[0];
    const newRow = document.createElement("tr");

    newRow.innerHTML = `
        <td><input type="text" name="poCustomerName[]" style="width: 95%; padding: 5px; box-sizing: border-box;"></td>
        <td><input type="text" name="poVehicleNo[]" style="width: 95%; padding: 5px; box-sizing: border-box;"></td>
        <td><input type="text" name="poNumber[]" style="width: 95%; padding: 5px; box-sizing: border-box;"></td>
        <td>
            <select name="poProduct[]" style="width:95%; padding:5px; box-sizing:border-box" onchange="updatePOPrice(this)">
                <option value="" disabled selected>Select Product</option>
                <option value="Premium">Premium</option>
                <option value="Unleaded">Unleaded</option>
                <option value="Diesel">Diesel</option>
            </select>
        </td>
        <td><input type="number" name="poLiters[]" style="width: 95%; padding: 5px; box-sizing: border-box;" oninput="updatePurchaseOrderTotal(this)"></td>
        <td><input type="number" name="poPrice[]" readonly style="width: 95%; padding: 5px; box-sizing: border-box; background-color: #e9ecef;"></td>
        <td><input type="number" name="poDiscount[]" data-column="PODiscount" style="width: 95%; padding: 5px; box-sizing: border-box;" oninput="updatePurchaseOrderTotal(this)"></td>
        <td><input type="number" name="poAmount[]" readonly style="width: 95%; padding: 5px; box-sizing: border-box; background-color: #e9ecef;"></td>
    `;

    purchaseOrderTableBody.appendChild(newRow);
    
    // ‚úÖ Update the new dropdown with the latest product list
    populateProductDropdown();

    // Apply restrictions to newly added Discount fields if the user is not admin
    if (currentUserRole === "user") {
        restrictFields('input[data-column="PODiscount"]');
    }
}
    
function populateProductDropdown() {
    console.log("üîÑ Populating Product Dropdown from Pump Section...");

    let productSet = new Set();

    document.querySelectorAll('[name$="Price"]').forEach(input => {
        let productName = input.name.replace(/[0-9]/g, '').replace("Price", "").trim(); // Remove numbers
        if (productName) productSet.add(productName);
    });

    let productList = Array.from(productSet);

    document.querySelectorAll('[name="poProduct[]"]').forEach(select => {
        select.innerHTML = '<option value="" disabled selected>Select Product</option>'; // Reset options
        productList.forEach(product => {
            select.innerHTML += `<option value="${product}">${product}</option>`;
        });
    });

    console.log("‚úÖ Product Dropdown Updated Successfully");
}

// function updatePurchaseOrderTotal(inputElement) {
//         // Get the row containing the changed input
//         var row = inputElement.closest("tr");
// 
//         // Get the values of liters and discount
//         var liters = parseFloat(row.querySelector('input[name="poLiters[]"]').value) || 0;
//         var discount = parseFloat(row.querySelector('input[name="poDiscount[]"]').value) || 0;
// 
//         // Calculate the amount
//         var amount = liters * discount;
// 
//         // Update the amount field in the current row
//         var amountField = row.querySelector('input[name="poAmount[]"]');
//         amountField.value = amount.toFixed(2);
// 
//         // Update the total amount at the bottom of the table
//         var totalAmountField = document.getElementById("poTotalAmount");
//         var totalAmount = Array.from(document.querySelectorAll('input[name="poAmount[]"]'))
//             .reduce((sum, amountInput) => sum + (parseFloat(amountInput.value) || 0), 0);
//         totalAmountField.value = totalAmount.toFixed(2);
//         
function updatePurchaseOrderTotal(inputElement) {
    const row = inputElement.closest("tr");

    const liters = parseFloat(row.querySelector('input[name="poLiters[]"]').value) || 0;
    const price = parseFloat(row.querySelector('input[name="poPrice[]"]').value) || 0;
    const discount = parseFloat(row.querySelector('input[name="poDiscount[]"]').value) || 0;

    // Calculate Amount
    const amount = (liters * price) - discount;
    row.querySelector('input[name="poAmount[]"]').value = amount.toFixed(2);

    // Calculate Total Purchase Order Amount
    let totalAmount = Array.from(document.querySelectorAll('input[name="poAmount[]"]'))
        .reduce((sum, input) => sum + (parseFloat(input.value) || 0), 0);
    document.getElementById("poTotalAmount").value = totalAmount.toFixed(2);

    console.log(`Updated PO Amount: ${amount}, Total PO: ${totalAmount}`);

    // ‚úÖ Call updateSummary() properly
    if (typeof updateSummary === "function") {
        updateSummary();
    } else {
        console.error("‚ùå updateSummary() is not defined.");
    }
}
</script>
<div class="section-title">Total Cash, Safe Drop, and Summary</div>
<div class="flex-row" style="display: flex; gap: 10px;">

    <!-- Cash Breakdown Column (40%) -->
    <div style="flex: 4;">
        <table id="cashBreakdownTable" style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
    <thead>
        <tr>
            <th style="text-align: center; width: 30%;">Denomination</th> <!-- Adjust Denomination column -->
            <th style="text-align: center; width: 25%;">No. of Pieces</th> <!-- Adjust No. of Pieces column -->
            <th style="text-align: center; width: 35%;">Amount</th> <!-- Adjust Amount column -->
        </tr>
    </thead>
            <tbody>
                <tr>
                    <td style="text-align: center;">1000</td>
                    <td><input type="number" name="denomination1000Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination1000Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">500</td>
                    <td><input type="number" name="denomination500Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination500Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">200</td>
                    <td><input type="number" name="denomination200Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination200Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">100</td>
                    <td><input type="number" name="denomination100Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination100Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">50</td>
                    <td><input type="number" name="denomination50Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination50Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">20</td>
                    <td><input type="number" name="denomination20Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination20Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">Coins 20</td>
                    <td><input type="number" name="denominationCoins20Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denominationCoins20Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">10</td>
                    <td><input type="number" name="denomination10Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination10Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">5</td>
                    <td><input type="number" name="denomination5Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination5Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">1</td>
                    <td><input type="number" name="denomination1Pieces" oninput="updateCashBreakdown()" style="width: 90%; text-align: center;"></td>
                    <td><input type="number" name="denomination1Amount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2" style="text-align: right; font-weight: bold;">Total Cash</td>
                    <td><input type="number" id="cashBreakdownTotal" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <!-- Safe Drop Column (35%) -->
    <div style="flex: 3;">
        <table id="safeDropTable" style="width: 100%; border-collapse: collapse;">
            <thead>
        <tr>
            <th style="text-align: center; white-space: nowrap; width: 45%;">Safe Drop</th> <!-- Adjust Safe Drop column -->
            <th style="text-align: center; white-space: nowrap; width: 55%;">Received</th> <!-- Adjust Received column -->
        </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="text-align: center;">1</td>
                    <td><input type="number" name="safeDropRow1" onchange="updateSafeDropTotal()" style="width: 75%; text-align: center;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">2</td>
                    <td><input type="number" name="safeDropRow2" onchange="updateSafeDropTotal()" style="width: 75%; text-align: center;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">3</td>
                    <td><input type="number" name="safeDropRow3" onchange="updateSafeDropTotal()" style="width: 75%; text-align: center;"></td>
                </tr>
                <tr>
                    <td style="text-align: center;">4</td>
                    <td><input type="number" name="safeDropRow4" onchange="updateSafeDropTotal()" style="width: 75%; text-align: center;"></td>
                </tr>
            </tbody>
                    <tfoot>
            <tr>
                <td style="text-align: right; font-weight: bold;">Total Safe Drop</td>
                <td><input type="number" id="totalSafeDrop" readonly style="width: 75%; text-align: center; background-color: #f2f2f2;"></td>
            </tr>
        </tfoot>
        </table>
        <button type="button" onclick="addSafeDropRow()" style="margin-top: 10px; padding: 8px 16px; font-size: 14px;">+ Add Safe Drop</button>
    </div>

    <!-- Summary Column (25%) -->
    <div style="flex: 3;">
        <table id="summaryTable" style="width: 100%; border-collapse: collapse;">
            <thead>
        <tr>
            <th style="text-align: center; width: 45%;">Details</th> <!-- Adjust Details column -->
            <th style="text-align: center; width: 55%;">Amount</th> <!-- Adjust Amount column -->
        </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Total Fuel Sales</td>
                    <td><input type="number" id="summaryFuelSales" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td>Total Expenses</td>
                    <td><input type="number" id="summaryExpenses" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td>Total Discount</td>
                    <td><input type="number" id="summaryDiscount" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td>Total P.O.</td>
                    <td><input type="number" id="summaryPO" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td>Total Cash</td>
                    <td><input type="number" id="summaryCash" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
                <tr>
                    <td>Short (-) or Over (+)</td>
                    <td><input type="number" id="shortOver" readonly style="width: 90%; text-align: center; background-color: #f2f2f2;"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Submit Button -->
<!-- 
<div style="text-align: center; margin-top: 20px;">
    <button type="submit" style="padding: 10px 20px; font-size: 16px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">Submit Report</button>
</div>      
 -->


<!-- Submit and Logout Buttons -->
<div style="text-align: center; margin-top: 20px;">
    <button type="submit" style="padding: 10px 20px; font-size: 16px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
        Submit Report
    </button>
    <button type="button" onclick="logoutUser()" style="padding: 10px 20px; font-size: 16px; background-color: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
        Logout
    </button>
</div>


<script>
function updateCashBreakdown() {
    const denominations = [
        { value: 1000, piecesField: 'denomination1000Pieces', amountField: 'denomination1000Amount' },
        { value: 500, piecesField: 'denomination500Pieces', amountField: 'denomination500Amount' },
        { value: 200, piecesField: 'denomination200Pieces', amountField: 'denomination200Amount' },
        { value: 100, piecesField: 'denomination100Pieces', amountField: 'denomination100Amount' },
        { value: 50, piecesField: 'denomination50Pieces', amountField: 'denomination50Amount' },
        { value: 20, piecesField: 'denomination20Pieces', amountField: 'denomination20Amount' },
        { value: 20, piecesField: 'denominationCoins20Pieces', amountField: 'denominationCoins20Amount' },
        { value: 10, piecesField: 'denomination10Pieces', amountField: 'denomination10Amount' },
        { value: 5, piecesField: 'denomination5Pieces', amountField: 'denomination5Amount' },
        { value: 1, piecesField: 'denomination1Pieces', amountField: 'denomination1Amount' },
    ];

    let total = 0;

    denominations.forEach(denomination => {
        const pieces = parseFloat(document.querySelector(`input[name="${denomination.piecesField}"]`).value) || 0;
        const amount = pieces * denomination.value;
        document.querySelector(`input[name="${denomination.amountField}"]`).value = amount.toFixed(2);
        total += amount;
    });

    // Update the total
    document.getElementById("cashBreakdownTotal").value = total.toFixed(2);
    
        // Update Summary
    updateSummary();
}
function addSafeDropRow() {
    const safeDropTableBody = document.getElementById("safeDropTable").getElementsByTagName("tbody")[0];
    const rowCount = safeDropTableBody.rows.length + 1; // Calculate the next row number

    const newRow = document.createElement("tr");

    newRow.innerHTML = `
        <td style="text-align: center;">${rowCount}</td>
        <td><input type="number" name="safeDropRow${rowCount}" onchange="updateSafeDropTotal()" style="width: 75%; padding: 5px; box-sizing: border-box;"></td>
    `;

    safeDropTableBody.appendChild(newRow);
}

function updateSafeDropTotal() {
    const safeDropAmounts = document.querySelectorAll('input[name^="safeDropRow"]');
    const total = Array.from(safeDropAmounts).reduce((sum, input) => {
        return sum + (parseFloat(input.value) || 0);
    }, 0);

    // Update Total Safe Drop Field
    document.getElementById("totalSafeDrop").value = total.toFixed(2);

    // Update Summary
    updateSummary();
}

function updateShortOver() {
    // Get values from relevant input fields
    const totalFuelSales = parseFloat(document.getElementById("totalFuelSales").value) || 0;
    const totalExpenses = parseFloat(document.getElementById("totalExpenses").value) || 0;
    const totalDiscount = parseFloat(document.getElementById("totalDiscount").value) || 0;
    const totalPO = parseFloat(document.getElementById("totalPO").value) || 0;
    const totalCash = parseFloat(document.getElementById("totalCash").value) || 0;

    // Compute Short (-) or Over (+)
    const shortOver = totalCash - (totalFuelSales - totalExpenses - totalDiscount - totalPO);

    // Update the Short/Over field
    document.getElementById("shortOver").value = shortOver.toFixed(2);
}
</script>

<!-- Add report number -->
<script>
    document.addEventListener("DOMContentLoaded", async () => {
        console.log("DOM fully loaded and parsed.");

        // Initialize Firebase
        firebase.initializeApp({
            apiKey: "AIzaSyDs0nHtHiQOANohq2TBm_xXUJ8qRtRQQhs",
            authDomain: "redstar-27bfa.firebaseapp.com",
            projectId: "redstar-27bfa",
            storageBucket: "redstar-27bfa.firebaseapp.com",
            messagingSenderId: "863347286957",
            appId: "1:863347286957:web:3e27391d7c0667174ef724",
            measurementId: "G-WBM4JBV99F"
        });

        const firestore = firebase.firestore();

        // Default report number
        let nextReportNumber = 1;

        // Fetch the last report number
        async function fetchLastReportNumber() {
            try {
                const querySnapshot = await firestore
                    .collection("gasStationReports")
                    .orderBy("reportNumber", "desc")
                    .limit(1)
                    .get();

                if (!querySnapshot.empty) {
                    const lastReport = querySnapshot.docs[0].data();
                    nextReportNumber = (lastReport.reportNumber || 0) + 1;
                }

                // Update the report number in the UI
                document.getElementById("reportNumber").innerText = `REPORT NUMBER: ${nextReportNumber}`;
            } catch (error) {
                console.error("Error fetching last report number:", error);
                document.getElementById("reportNumber").innerText = "REPORT NUMBER: Error";
            }
        }

        // Call this function on page load to fetch the last report number
        await fetchLastReportNumber();

        // Form submission
        const gasStationForm = document.getElementById("gasStationForm");

        if (gasStationForm) {
            console.log("Form element found.");
            gasStationForm.addEventListener("submit", async function (e) {
                e.preventDefault();

                const formData = new FormData(e.target);
                const reportData = Object.fromEntries(formData.entries());

                // Add the report number to the report data
                reportData.reportNumber = nextReportNumber;
                
                // ‚úÖ FIX: Add branch selection before submitting to Firestore
reportData.branch = document.getElementById("branchSelection").value;

                try {
                    const docRef = await firestore.collection("gasStationReports").add(reportData);
                    console.log(`Document written with ID: ${docRef.id}`);
                    alert(`Report submitted successfully! Report Number: ${nextReportNumber}`);
                    e.target.reset(); // Clear the form
                    location.reload(); // Reload to fetch the next report number
                } catch (error) {
                    console.error("Error submitting report:", error);
                    alert("Failed to submit the report. Please try again.");
                }
            });
        } else {
            console.error("Form element not found.");
        }
    });
</script>

<!-- 
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            console.log("DOM fully loaded and parsed.");
            firebase.initializeApp({
                apiKey: "AIzaSyDs0nHtHiQOANohq2TBm_xXUJ8qRtRQQhs",
                authDomain: "redstar-27bfa.firebaseapp.com",
                projectId: "redstar-27bfa",
                storageBucket: "redstar-27bfa.firebasestorage.app",
                messagingSenderId: "863347286957",
                appId: "1:863347286957:web:3e27391d7c0667174ef724",
                measurementId: "G-WBM4JBV99F"
            });
            let r = firebase.firestore();
            var e = document.getElementById("gasStationForm");
            e ? (console.log("Form element found."), e.addEventListener("submit", async e => {
                console.log("Submit event triggered."), e.preventDefault();
                var t = new FormData(e.target),
                    t = Object.fromEntries(t.entries());
                console.log("Collected data:", t);
                try {
                    var o = await r.collection("gasStationReports").add(t);
                    console.log("Document written with ID:", o.id), alert("Report submitted successfully! Document ID: " + o.id), e.target.reset()
                } catch (e) {
                    console.error("Error saving document:", e), alert("Failed to submit the report. Check console for details.")
                }
            })) : console.error("Form element not found.")
        })
    </script>
 -->
    <script>
function updateValues(input) {
    const row = input.closest("tr");
    const opening = parseFloat(row.querySelector('input[name$="Opening"]').value) || 0;
    const closing = parseFloat(row.querySelector('input[name$="Closing"]').value) || 0;
    const calibration = parseFloat(row.querySelector('input[name$="Calibration"]').value) || 0;
    const price = parseFloat(row.querySelector('input[name$="Price"]').value) || 0;

    // Calculate Liters Sold and Total Sales
    const litersSold = closing - opening - calibration;
    const totalSales = litersSold * price;

    // Update Liters Sold and Total Sales fields
    row.querySelector('input[name$="Liters"]').value = litersSold.toFixed(2);
    row.querySelector('input[name$="Sales"]').value = totalSales.toFixed(2);

    // Trigger Total Fuel Sales recalculation
    computeDipstickFromPumpReadings();
    updateFuelSalesTotal();
        // Update Summary
    updateSummary();
}

function updateFuelSalesTotal() {
    const productSalesFields = [
        'input[name="premium1Sales"]',
        'input[name="premium2Sales"]',
        'input[name="unleaded1Sales"]',
        'input[name="unleaded2Sales"]',
        'input[name="diesel1Sales"]',
        'input[name="diesel2Sales"]'
    ];

    let totalSales = 0;

    // Iterate over each field selector
    productSalesFields.forEach(selector => {
        const input = document.querySelector(selector);
        const value = parseFloat(input?.value) || 0; // Safely get the value or default to 0
        console.log(`Selector: ${selector}, Value: ${value}`); // Debugging: Log the selector and value
        totalSales += value;
    });

    console.log(`Total Sales Calculated: ${totalSales}`); // Debugging: Log the total sales

    // Update the Total Fuel Sales field
    document.getElementById("totalFuelSales").value = totalSales.toFixed(2);
    
}
 
</script>
    
<script>
    
function computeDipstickFromPumpReadings() {
    // Premium Total Liters Sold
    const premium1Liters = parseFloat(document.querySelector('input[name="premium1Liters"]').value) || 0;
    const premium2Liters = parseFloat(document.querySelector('input[name="premium2Liters"]').value) || 0;
    const premiumTotal = premium1Liters + premium2Liters;
    document.getElementById("premiumTotalLitersSold").value = premiumTotal.toFixed(2);

    // Unleaded Total Liters Sold
    const unleaded1Liters = parseFloat(document.querySelector('input[name="unleaded1Liters"]').value) || 0;
    const unleaded2Liters = parseFloat(document.querySelector('input[name="unleaded2Liters"]').value) || 0;
    const unleadedTotal = unleaded1Liters + unleaded2Liters;
    document.getElementById("unleadedTotalLitersSold").value = unleadedTotal.toFixed(2);

    // Diesel Total Liters Sold
    const diesel1Liters = parseFloat(document.querySelector('input[name="diesel1Liters"]').value) || 0;
    const diesel2Liters = parseFloat(document.querySelector('input[name="diesel2Liters"]').value) || 0;
    const dieselTotal = diesel1Liters + diesel2Liters;
    document.getElementById("dieselTotalLitersSold").value = dieselTotal.toFixed(2);
}

function updateSummary() {
    // Fetch totals from respective sections
    const totalFuelSales = parseFloat(document.getElementById("totalFuelSales").value) || 0;
    const totalExpenses = parseFloat(document.getElementById("totalExpenses").value) || 0;
    const totalDiscount = parseFloat(document.getElementById("totalDiscount").value) || 0;
    const totalPO = parseFloat(document.getElementById("poTotalAmount").value) || 0;
    const cashBreakdownTotal = parseFloat(document.getElementById("cashBreakdownTotal").value) || 0;
    const totalSafeDrop = parseFloat(document.getElementById("totalSafeDrop").value) || 0;

    // Update Summary Section fields
    document.getElementById("summaryFuelSales").value = totalFuelSales.toFixed(2);
    document.getElementById("summaryExpenses").value = totalExpenses.toFixed(2);
    document.getElementById("summaryDiscount").value = totalDiscount.toFixed(2);
    document.getElementById("summaryPO").value = totalPO.toFixed(2);

    // Compute Total Cash as cashBreakdownTotal + totalSafeDrop
    const totalCash = cashBreakdownTotal + totalSafeDrop;
    document.getElementById("summaryCash").value = totalCash.toFixed(2);

    // Recalculate Short (-) or Over (+)
    updateShortOver();
}

function updateShortOver() {
    // Get values from the summary section
    const totalFuelSales = parseFloat(document.getElementById("summaryFuelSales").value) || 0;
    const totalExpenses = parseFloat(document.getElementById("summaryExpenses").value) || 0;
    const totalDiscount = parseFloat(document.getElementById("summaryDiscount").value) || 0;
    const totalPO = parseFloat(document.getElementById("summaryPO").value) || 0;
    const totalCash = parseFloat(document.getElementById("summaryCash").value) || 0;

    // Compute Short (-) or Over (+)
    const shortOver = totalCash - (totalFuelSales - totalExpenses - totalDiscount - totalPO);

    // Update the Short/Over field
    document.getElementById("shortOver").value = shortOver.toFixed(2);
}

//function computeDipstickClosing() {
//    // Premium Closing
//   const premium1Closing = parseFloat(document.querySelector('input[name="premium1Closing"]').value) || 0;
//    const premium2Closing = parseFloat(document.querySelector('input[name="premium2Closing"]').value) || 0;
//    const premiumClosing = premium1Closing + premium2Closing;
//    document.getElementById("premiumClosing").value = premiumClosing.toFixed(2);

    // Unleaded Closing
//    const unleaded1Closing = parseFloat(document.querySelector('input[name="unleaded1Closing"]').value) || 0;
//    const unleaded2Closing = parseFloat(document.querySelector('input[name="unleaded2Closing"]').value) || 0;
//    const unleadedClosing = unleaded1Closing + unleaded2Closing;
//    document.getElementById("unleadedClosing").value = unleadedClosing.toFixed(2);

    // Diesel Closing
//    const diesel1Closing = parseFloat(document.querySelector('input[name="diesel1Closing"]').value) || 0;
//    const diesel2Closing = parseFloat(document.querySelector('input[name="diesel2Closing"]').value) || 0;
//    const dieselClosing = diesel1Closing + diesel2Closing;
//    document.getElementById("dieselClosing").value = dieselClosing.toFixed(2);
// }



// Add Event Listeners to recalculate when values in Electronic Pump Reading change
document.querySelectorAll('#premium1Liters, #premium2Liters, #unleaded1Liters, #unleaded2Liters, #diesel1Liters, #diesel2Liters').forEach(input => {
    input.addEventListener('input', computeDipstickFromPumpReadings);
});
</script>

    <script>
        // Function to update the total expenses
function updateTotalExpenses() {
    const expenseAmounts = document.querySelectorAll('input[name="expensesAmount[]"]');
    let total = 0;

    expenseAmounts.forEach(input => {
        total += parseFloat(input.value) || 0;
    });

    document.getElementById("totalExpenses").value = total.toFixed(2);

    // Update Summary
    updateSummary();
}
//
        // Function to add a new expense row dynamically
//        function addExpenseRow() {
//            const expensesTable = document.getElementById("expensesTable").getElementsByTagName("tbody")[0];
 //           const newRow = document.createElement("tr");
//
//            newRow.innerHTML = `
 //               <td><input type="text" name="expensesParticulars[]"></td>
//                <td><input type="number" name="expensesAmount[]" oninput="updateTotalExpenses()"></td>
//            `;
//
 //           expensesTable.appendChild(newRow);
 //       }
    </script>
</div>
    <script>
        // Prevent form submission on Enter key press
        document.getElementById("loginForm").addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                // Prevent form submission when Enter is pressed
                event.preventDefault();

                // Optionally, move to the next input
                const formElements = Array.from(this.elements);
                const currentIndex = formElements.indexOf(document.activeElement);

                if (currentIndex !== -1 && formElements[currentIndex + 1]) {
                    formElements[currentIndex + 1].focus(); // Move to the next input
                }
            }
        });
    </script>
    
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Prevent Enter key from submitting all forms except for #loginForm
        document.querySelectorAll("form").forEach(form => {
            form.addEventListener("keydown", function (event) {
                // Check if the Enter key is pressed
                if (event.key === "Enter") {
                    // If it's the login form, allow Enter to submit
                    if (this.id === "loginForm") {
                        return;
                    }
                    // Prevent Enter from submitting any other form
                    event.preventDefault();

                    // Optionally, focus on the next input in the current form
                    const formElements = Array.from(this.elements);
                    const currentIndex = formElements.indexOf(document.activeElement);
                    if (currentIndex !== -1 && formElements[currentIndex + 1]) {
                        formElements[currentIndex + 1].focus(); // Move focus to the next input
                    }
                }
            });
        });

        // Add step="0.01" to all <input type="number"> elements
        const numberInputs = document.querySelectorAll('input[type="number"]');
        numberInputs.forEach(input => {
            input.setAttribute("step", "0.01");
        });

        console.log(`Updated ${numberInputs.length} number input fields to accept decimals.`);
    });
</script>


<!-- Add Report Number -->
<script>
    let nextReportNumber = 1; // Default report number if no previous report exists

    async function fetchLastReportNumber() {
        try {
            const querySnapshot = await firebase.firestore()
                .collection("gasStationReports")
                .orderBy("reportNumber", "desc")
                .limit(1)
                .get();

            if (!querySnapshot.empty) {
                const lastReport = querySnapshot.docs[0].data();
                nextReportNumber = (lastReport.reportNumber || 0) + 1; // Increment the last report number
            }

            // Update the UI
            document.getElementById("reportNumber").innerText = `REPORT NUMBER: ${nextReportNumber}`;
        } catch (error) {
            console.error("Error fetching last report number:", error);
            document.getElementById("reportNumber").innerText = "REPORT NUMBER: Error";
        }
    }

    // Call this function on page load to fetch and display the report number
    document.addEventListener("DOMContentLoaded", fetchLastReportNumber);
</script>

<script>

// let previousPrices = {
//     premium: 0,
//     unleaded: 0,
//     diesel: 0
// };
// 
// // üîπ Fetch latest pump prices from Firebase on page load
// async function preFillPumpPrices() {
//     const firestore = firebase.firestore();
// 
//     try {
//         const querySnapshot = await firestore
//             .collection("gasStationReports")
//             .orderBy("reportNumber", "desc")
//             .limit(1)
//             .get();
// 
//         if (!querySnapshot.empty) {
//             const lastReport = querySnapshot.docs[0].data();
//             
//             // Store prices in global variable
//             previousPrices.premium = parseFloat(lastReport.premium1Price) || 0;
//             previousPrices.unleaded = parseFloat(lastReport.unleaded1Price) || 0;
//             previousPrices.diesel = parseFloat(lastReport.diesel1Price) || 0;
// 
//             // Prefill the Electronic Reading section
//             document.getElementById("premium1Price").value = previousPrices.premium;
//             document.getElementById("unleaded1Price").value = previousPrices.unleaded;
//             document.getElementById("diesel1Price").value = previousPrices.diesel;
//         }
//     } catch (error) {
//         console.error("Error fetching previous report:", error);
//     }
// }
// ---------------------------------------------------
// async function preFillPumpPrices() {
//     const firestore = firebase.firestore();
//     
//     try {
//         // Fetch the latest report
//         const querySnapshot = await firestore
//             .collection("gasStationReports")
//             .orderBy("reportNumber", "desc")
//             .limit(1)
//             .get();
// 
//         if (!querySnapshot.empty) {
//             const lastReport = querySnapshot.docs[0].data();
//             
//             // Mapping fields from last report to corresponding inputs
//             const priceFields = {
//                 "premium1Price": "premium1Price",
//                 "premium2Price": "premium2Price",
//                 "unleaded1Price": "unleaded1Price",
//                 "unleaded2Price": "unleaded2Price",
//                 "diesel1Price": "diesel1Price",
//                 "diesel2Price": "diesel2Price"
//             };
// 
//             // Iterate through the price fields and pre-fill them
//             Object.keys(priceFields).forEach(key => {
//                 if (lastReport[key] !== undefined) {
//                     document.querySelector(`input[name="${priceFields[key]}"]`).value = lastReport[key];
//                 }
//             });
// 
//             console.log("Pump prices pre-filled successfully from previous report.");
//         } else {
//             console.log("No previous report found.");
//         }
//     } catch (error) {
//         console.error("Error fetching previous report:", error);
//     }
// }

// Execute the function after Firebase is initialized
document.addEventListener("DOMContentLoaded", () => {
    preFillPumpPrices();
    fetchPreviousPumpPrices();
    console.log("üöÄ Page Loaded, Fetching Prices from Pump Section...");
    updatePreviousPricesFromPumpSection(); // ‚úÖ Fetch prices when the page loads
});

function logoutUser() {
    // Clear current user session
    currentUserRole = null;

    // Hide the main content and show the login screen
    document.getElementById("mainContent").style.display = "none";
    document.getElementById("loginScreen").style.display = "flex";

    // Reset the login form fields
    document.getElementById("username").value = "";
    document.getElementById("password").value = "";

    console.log("User logged out successfully.");
}
// 
// function updatePumpReadingsFromReport(lastReport) {
//     const pumpMappings = {
//         "premium1Closing": "premium1Opening",
//         "premium2Closing": "premium2Opening",
//         "unleaded1Closing": "unleaded1Opening",
//         "unleaded2Closing": "unleaded2Opening",
//         "diesel1Closing": "diesel1Opening",
//         "diesel2Closing": "diesel2Opening"
//     };
// 
//     Object.keys(pumpMappings).forEach(closingKey => {
//         const openingKey = pumpMappings[closingKey];
// 
//         if (lastReport.hasOwnProperty(closingKey)) {
//             const interval = setInterval(() => {
//                 const inputField = document.querySelector(`input[name="${openingKey}"]`);
//                 
//                 if (inputField) {
//                     inputField.value = lastReport[closingKey];
//                     console.log(`‚úÖ Updated ${openingKey} to ${lastReport[closingKey]}`);
//                     clearInterval(interval); // Stop checking
//                 } else {
//                     console.warn(`‚è≥ Waiting for input field to load: ${openingKey}`);
//                 }
//             }, 500); // Retry every 500ms
//         } else {
//             console.warn(`‚ö†Ô∏è Missing closing field in Firestore: ${closingKey}`);
//         }
//     });
// }

function updateBranchAddress() {
    const branchSelection = document.getElementById("branchSelection").value;
    const addressField = document.getElementById("branchAddress");

    // Define branch addresses with separate lines
    const branchAddresses = {
        branch1: {
            name: "Red Star Gas Station",
            location: "(Brgy Bayaoas, Urdaneta, Pangasinan)"
        },
        branch2: {
            name: "MVS Gas Station",
            location: "(Brgy Bantog, Asingan, Pangasinan)"
        },
        branch3: {
            name: "Star 888 Gas Station",
            location: "(Concepcion, Tarlac)"
        }
    };

    // Update address dynamically based on selection
    if (branchSelection in branchAddresses) {
        addressField.innerHTML = `
            <span style="display:block; font-weight: bold;">${branchAddresses[branchSelection].name}</span>
            <span style="display:block; font-size: 14px; color: #555;">${branchAddresses[branchSelection].location}</span>
        `;
    } else {
        addressField.innerHTML = "";
    }
}
</script>

<script>
    function resetPumpOpenings() {
        console.log("üîÑ Resetting pump opening values...");

        const openingFields = [
            "premium1Opening", "premium2Opening",
            "unleaded1Opening", "unleaded2Opening",
            "diesel1Opening", "diesel2Opening"
        ];

        openingFields.forEach(fieldName => {
            const inputField = document.querySelector(`input[name="${fieldName}"]`);
            if (inputField) {
                inputField.value = ""; // Reset to empty before fetching new values
            }
        });

        console.log("‚úÖ Pump opening values reset.");
    }

// Function to reset pump prices
function resetPumpPrices() {
    console.log("üîÑ Resetting pump price values...");

    // List of pump price fields to reset
    const pumpPriceFields = [
        "premium1Price", "premium2Price",
        "unleaded1Price", "unleaded2Price",
        "diesel1Price", "diesel2Price"
    ];

    // Reset each price field to empty or 0
    pumpPriceFields.forEach(fieldId => {
        const inputField = document.getElementById(fieldId);
        if (inputField) {
            inputField.value = ""; // Clear the value
            console.log(`‚úÖ Reset ${fieldId}`);
        }
    });

    console.log("‚úÖ All pump prices reset.");
}

    async function fetchPreviousPumpReadings() {
        console.log("üî• Fetching previous pump readings...");

        const firestore = firebase.firestore();
        const branchSelection = document.getElementById("branchSelection").value;

        if (!branchSelection) {
            console.log("üö® No branch selected. Skipping fetch.");
            return;
        }

        console.log(`üîç Searching for reports for branch: ${branchSelection}`);

        try {
            const querySnapshot = await firestore
                .collection("gasStationReports")
                .where("branchSelection", "==", branchSelection)
                .orderBy("reportNumber", "desc")
                .limit(1)
                .get();

            if (querySnapshot.empty) {
                console.warn("‚ùå No previous reports found for this branch.");
                return;
            }

            const lastReport = querySnapshot.docs[0].data();
            console.log("üìÑ Last report fetched:", lastReport);

            const pumpMappings = {
                "premium1Closing": "premium1Opening",
                "premium2Closing": "premium2Opening",
                "unleaded1Closing": "unleaded1Opening",
                "unleaded2Closing": "unleaded2Opening",
                "diesel1Closing": "diesel1Opening",
                "diesel2Closing": "diesel2Opening"
            };

            Object.keys(pumpMappings).forEach(closingKey => {
                const openingKey = pumpMappings[closingKey];

                if (lastReport.hasOwnProperty(closingKey)) {
                    const inputField = document.querySelector(`input[name="${openingKey}"]`);

                    if (inputField) {
                        inputField.value = lastReport[closingKey];
                        console.log(`‚úÖ Updated ${openingKey} to ${lastReport[closingKey]}`);
                    } else {
                        console.warn(`‚ö†Ô∏è Input field not found in DOM: ${openingKey}`);
                    }
                } else {
                    console.warn(`‚ö†Ô∏è Missing field in Firestore: ${closingKey}`);
                }
            });

            console.log("üéØ Pump openings updated successfully!");
        } catch (error) {
            console.error("‚ùå Error fetching previous pump readings:", error);
        }
    }

    async function fetchPreviousPumpPrices() {
        console.log("üî• Fetching previous pump prices...");

        const firestore = firebase.firestore();
        const branchSelection = document.getElementById("branchSelection").value;

        if (!branchSelection) {
            console.log("üö® No branch selected. Skipping fetch.");
            return;
        }

        console.log(`üîç Searching for pump prices for branch: ${branchSelection}`);

        try {
            const querySnapshot = await firestore
                .collection("gasStationReports")
                .where("branchSelection", "==", branchSelection)
                .orderBy("reportNumber", "desc")
                .limit(1)
                .get();

            if (querySnapshot.empty) {
                console.warn("‚ùå No previous pump prices found for this branch.");
                return;
            }

            const lastReport = querySnapshot.docs[0].data();
            console.log("üìÑ Last report fetched:", lastReport);

            document.getElementById("premium1Price").value = lastReport.premium1Price || 0;
            document.getElementById("unleaded1Price").value = lastReport.unleaded1Price || 0;
            document.getElementById("diesel1Price").value = lastReport.diesel1Price || 0;

            console.log("üéØ Pump prices updated successfully!");
        } catch (error) {
            console.error("‚ùå Error fetching previous pump prices:", error);
        }
    }

 //    function handleBranchChange() {
//         console.log("üî• Branch changed, resetting previous values...");
// 
// 		resetFormFields();
// 		resetPumpOpenings();
//         resetPumpPrices();
//         updateBranchAddress();
//         fetchPreviousPumpReadings().then(() => {
//         updatePreviousPricesFromPumpSection(); // ‚úÖ Update prices after fetching pump readings
//         updateAllPOPrices(); // ‚úÖ Update PO Prices only after fetching pump data
//     	});
//         fetchPreviousPumpPrices();
//     }

async function handleBranchChange() {
    console.log("üî• Branch changed, resetting previous values...");

    resetFormFields();
    resetPumpOpenings();
    resetPumpPrices();
    updateBranchAddress();

    await fetchPreviousPumpPrices();
    await fetchPreviousPumpReadings();

    updateAllPOPrices(); // ‚úÖ Now updates PO prices only if products are selected
}

    document.addEventListener("DOMContentLoaded", () => {
        console.log("‚úÖ DOM fully loaded.");

        const branchDropdown = document.getElementById("branchSelection");
        if (branchDropdown) {
            branchDropdown.addEventListener("change", handleBranchChange);
            console.log("‚úÖ Branch dropdown event listener attached.");
        } else {
            console.error("‚ùå Branch dropdown not found!");
        }
    });
    
function resetFormFields() {
    console.log("üîÑ Resetting all form fields (except branch selection)...");

    document.querySelectorAll("#gasStationForm input, #gasStationForm select").forEach(field => {
        if (field.id === "branchSelection" || field.id === "reportNumber") {
            // ‚ùå Skip resetting branch selection and report number
            return;
        }

        if (field.type === "text" || field.type === "number" || field.type === "date") {
            field.value = ""; // ‚úÖ Clear input fields
        } else if (field.type === "select-one") {
            field.selectedIndex = 0; // ‚úÖ Reset dropdowns
        }
    });

    console.log("‚úÖ All form fields reset (except branch selection).");
}

function updateAllPOPrices() {
    console.log("üîÑ Ensuring PO prices only update when a product is selected...");

    document.querySelectorAll('[name="poProduct[]"]').forEach(select => {
        if (select.value) {
            updatePOPrice(select); // ‚úÖ Only update if a product is selected
        }
    });

    console.log("‚úÖ PO prices updated where products were selected.");
}

</script>
</body>
</html>
